{% extends 'base.details.html.twig' %}
{% block tp %}
    <div style="background-color: gray ; width: 70px ; height: 30px ; align-items: center ;align-content: center">
        <a  href="/activitySchedule"><h5>Home</h5></a>
    </div>
    <div style="background-color: yellow ; width: 130px ; height: 30px ; align-items: center ;align-content: center">
        <a  href="/activity"><h5>Show More</h5></a>
    </div>

{% endblock %}
{% set i = activity.images  %}
{% block fimage %}

    {% if i|length >0 %}

       <img src="http://127.0.0.1:8000/uploads/{{ i[0].getImageUrl() }}" style="width: 100% ; height: 400px" class="img-fluid" id="big_img" alt="">
{#        <img src="http://127.0.0.1:8000/uploads/30e8f34236460ef32d5efbc1ed5df021.jpeg" class="img-fluid" id="big_img" alt="">#}
    {% else%}
        <img src="http://127.0.0.1:8000/uploads/noimg.jpg" alt="">
    {% endif %}
{% endblock %}
{% block Participe %}




{% endblock %}
{% block tit %}
    <table>
        <tr>
            <td>
                <h2>{{ activity.getNomAct() }}</h2>
            </td>
            <td style="padding-left: 400px">
{#                {% set Dateact = date(activity.getDateAct) %}#}
{#                {% if  Dateact < ctdate  %}#}
                    {% if userparticipated< activity.getQuantite%}

                        {% if not participe  %}
                            {{ form_start(btnParticipe,{'attr': {'novalidate': 'novalidate'}}) }}
                            {{ form_row(btnParticipe.Participe ,  { 'attr': {'class': ' button buttonparticipe'}})}}
                            {{ form_end(btnParticipe) }}
                        {% else %}
                            <button disabled class="button ">Participed</button>
                        {% endif %}
                    {% else%}
                        <button disabled class="button1 ">No Place</button>
                    {% endif %}
                <iframe src="https://www.facebook.com/plugins/share_button.php?href=http%3A%2F%2F127.0.0.1:8000%2Factivity%2Fdetails%2F{{ activity.getId() }}%2F&layout=button_count&size=large&appId=214722496787236&width=110&height=28" width="110" height="28" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>
                {#                {% else %}#}
{#                    <button disabled class="button ">passed</button>#}
{#                    <h1>{{  not(1==2) }}</h1>#}


{#                {% endif %}#}
            </td>
        </tr>
    </table>

{% endblock %}
{% block cat %}
    {{ activity.getCategory.getNomCat() }}

{% endblock %}
{% block dt %}
    {{ activity.getDateAct|date('Y-m-d') }} , {{ activity.getTempAct|date('H:m') }}
{% endblock %}
{% block qt %}
   participer par : {{ userparticipated}} /{{ activity.getQuantite }}
{% endblock %}
{% block des %}
    {{ activity.getDescriptionAct() }}
{% endblock %}
{% block star %}
 <form action="{{ path('activityDetails',{'id':activity.getId}) }}" method="post">
    <div style="margin-left: 80%" class="ratee">
        {% if not heRated %}
        <input type="hidden" value="" id="ratenote" name="rate" />
        <button style="background: none ; border: none">


            <i class="star" data-note="1">&#9733;</i>
            <i class="star" data-note="2">&#9733;</i>
            <i class="star" data-note="3">&#9733;</i>
            <i class="star" data-note="4">&#9733;</i>
            <i class="star" data-note="5">&#9733;</i>
        </button>
        {% else %}
            {% for i in 1..didRated.getRate %}
            <i class="hover2" >&#9733;</i>
        {% endfor %}
            {% if 5-didRated.getRate !=0 %}
                {% for j in 1..5-didRated.getRate %}
                    <i class="star2" >&#9733;</i>
                {% endfor %}
            {% endif %}
        {% endif %}
    </div>
 </form>
<input type="hidden" value="{{ activity.getId() }}" id="idact"/>
{#    <input type="hidden" value="{{ user }}" id="user"/>#}
{# <h1 id="idact" hidden>{{activity.getId()}}</h1>#}



{% endblock %}
{% block pict %}
   {% for image in i %}
    <li>

            <img class="img-fluid" style="height: 50% ; width: 100%" src="http://127.0.0.1:8000/uploads/{{ image.getImageUrl() }}" id="small_img" alt="">

    </li>
    {% endfor %}

{% endblock %}
{% block commentaire %}
<div class="boit-msg " id="boitmesg">

</div>
{% endblock %}
{% block Exercice %}
    {% for e in activity.exercices %}
    <div class="media post_item">
        <img  style=" width:40%" src="http://127.0.0.1:8000/uploads/noimg.jpg"  alt="post">
        <div class="media-body">
            <a href="blog_details.html">
                <h3>{{ e.getNomExercice()}}</h3>
            </a>
            <p>{{ e.getDureExercice()}}</p>
        </div>
    </div>
    {% endfor %}
    <script>


        $(document).ready(function(){

            $(".img-fluid").click(function(){
                $("#big_img").attr('src',$(this).attr('src'));
            });
        });

    </script>
    <script>
        const stars =document.querySelectorAll('.star');
        let check = false;
        stars.forEach(star=>{
            star.addEventListener('mouseover',selectStars);
            star.addEventListener('mouseleave',unselectStars);

            star.addEventListener('click',activeSelect);



        })
        function selectStars(e){
            const data =e.target;
            const etoiles = priviousSiblings(data);
            if(!check){
                etoiles.forEach(etoile=>{
                    etoile.classList.add('hover');
                })
            }


        }
        function unselectStars(e){
            const data =e.target;
            const etoiles = priviousSiblings(data);
            if(!check){
                etoiles.forEach(etoile=>{
                    etoile.classList.remove('hover');
                })
            }

        }
        function priviousSiblings(data){
            let values=[data];
            while (data= data.previousSibling){
                if(data.nodeName ==='I'){
                    values.push(data);
                }
            }
            return values;
        }
        function  activeSelect(e){
            check=true;
           /* document.querySelector('.ratenote').innerHTML='Note: '+ e.target.dataset.note;*/
            document.getElementById("ratenote").value = e.target.dataset.note;

        }
        $(document).ready(
            function () {
            let idactivity = $("#idact").val();
            $.ajax({

                url:"http://127.0.0.1:8000/activity/json/detail/"+idactivity,
                type: "get",
                dataType: "json",
                cache: false,
                success: function (data , status) {
                    console.log("hello",data.rate);
                    let rt="";
                   if (data.rate!=0){
                       for (let i=0 ; i<data.rate ; i++){
                           rt+="<i class='hover2' >&#9733;</i>";

                       }
                       for (let i=0 ; i<5-data.rate ; i++){
                           rt+="<i class='star2' >&#9733;</i>";

                       }
                       $(".ratee").html(rt);
                   }



                },
                error: function (data) {
                    console.log("err",idactivity );
                },
            });

        });
    </script>
<script>

    $(document).ready(function () {
       /* $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });*/
        //post information for commentaire
        $("#commentForm").submit(function(e)
        {
            e.preventDefault();
            var formData  =$("#commentForm").serialize(); //data mn formulaire
            let idact = $("#idact").val();
            // let user = $("#user").val();
            var msg = $("#website").val();
            console.log(idact);
           // let date = $("#nom").text();


            $.ajax({


                url:"http://127.0.0.1:8000/commentaiire/add/"+msg+"/"+idact,
                type:"post",
                data:formData,
                success:function(dataBack)
                {
                    // 	$("#boitmesg").append(`
                    //       	<div> <Strong>${nom}  :</Strong> ${msg}	</div>

                    //  `)
                    /*console.log("sucess");
                    $('.hh').val("");
                    document.getElementById("website").value = "";*/



                }, error: function (xhr, status, error)
                {
                    console.log(error);
                }
            });
            $('.hh').val("");
            document.getElementById("website").value = "";



        });
        //get Information for commentaire
        setInterval(function () {
            let idactivity = $("#idact").val();
            $.ajax({

                url:"http://127.0.0.1:8000/commentaiire/"+idactivity,
                type: "get",
                dataType: "json",
                cache: false,
                success: function (data , status) {
                    console.log(data)
                     let l = data.length;
                    var  tt= "<div class='comment-list'>"+
                        "<div class='single-comment justify-content-between d-flex'>"+
                            "<div class='user justify-content-between d-flex'>"+
                                "<div class='thumb'>"+
                                    "<img src='{{ asset('detail/assets/img/comment/comment_1.png') }}' alt=''>"+
                                "</div>"+
                                "<div class='desc'>"+
                                   "<p class='comment'>" +
                                       "hh"+
                                    "</p>"+
                                   "<div class='d-flex justify-content-between'>" +
                                       "<div class='d-flex align-items-center'>" +
                                           "<h5>" +
                                            "Emilly Blunt"    +
                                           "</h5>" +
                                           "<p class='date'>December 4, 2017 at 3:12 pm </p>" +
                                        "</div>"+

                                   "</div>" +
                               "</div>" +
                           "</div>" +
                       "</div>" +
                   "</div>" ;



                    console.log(l,"taille");

                    var MSG="";
                     for (let i =0; i < l; i++){
                         MSG += "<div class='comment-list'>"+
                             "<div class='single-comment justify-content-between d-flex'>"+
                             "<div class='user justify-content-between d-flex'>"+
                             "<div class='thumb'>"+
                             "<img src='{{ asset('detail/assets/img/comment/comment_1.png') }}' alt=''>"+
                             "</div>"+
                             "<div class='desc'>"+
                             "<p class='comment'>" +
                             data[i].textcommentaire+
                             "</p>"+
                             "<div class='d-flex justify-content-between'>" +
                             "<div class='d-flex align-items-center'>" +
                             "<h5>" +
                             data[i].iduser    +
                             "</h5>" +
                             "<p class='date'>"+data[i].dateCom+"</p>" +
                             "</div>"+

                             "</div>" +
                             "</div>" +
                             "</div>" +
                             "</div>" +
                             "</div>" ;
                         //"<div class='messages'><Strong>"+ data[i].iduser + ":</Strong>"+ data[i].textcommentaire +"</div></br>"
                     }
                    $("#boitmesg").html(MSG);
                },
                error: function (data) {
                    console.log("err",idactivity );
                },
            });
        },5000);
    });


</script>

{% endblock %}

{% block c %}


{% endblock %}